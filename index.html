<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lepsze Pepsi</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #0f1116;
      color: #fff;
    }

    h1 {
      text-align: center;
      background: #1a1f2e;
      margin: 0;
      padding: 1em;
      color: #00bfff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }

    #map {
      height: 400px;
      width: 100%;
      filter: grayscale(20%);
    }

    form {
      background: #1a1f2e;
      padding: 1em;
      margin: 1em;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 191, 255, 0.1);
    }

    input, textarea, select {
      width: 100%;
      padding: 0.7em;
      margin-bottom: 1em;
      border: none;
      border-radius: 8px;
      background: #2b2f3d;
      color: #fff;
    }

    input::placeholder, textarea::placeholder, select {
      color: #bbb;
    }

    button {
      background: #00bfff;
      color: #fff;
      padding: 0.8em;
      border: none;
      width: 100%;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #0099cc;
    }

    img {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>Lepsze Pepsi – Twoje Miejsca</h1>

<div id="map"></div>

<form id="placeForm">
  <input type="text" id="name" placeholder="Nazwa miejsca" required />
  <textarea id="desc" placeholder="Opis (max 500 słów)" maxlength="2000" required></textarea>
  <select id="rating" required>
    <option value="">Ocena obsługi</option>
    <option value="1">1 - Słabo</option>
    <option value="2">2</option>
    <option value="3">3 - OK</option>
    <option value="4">4</option>
    <option value="5">5 - Super</option>
  </select>
  <select id="palletAccess" required>
    <option value="">Wjazd paletą?</option>
    <option value="Tak">Tak</option>
    <option value="Nie">Nie</option>
  </select>
  <input type="file" id="photo" accept="image/*" />
  <button type="submit">Dodaj miejsce</button>
</form>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDSlED_07CPrKkzv-GaHko8yhLI93M6QUg",
    authDomain: "lepszepepsi-d2fa6.firebaseapp.com",
    projectId: "lepszepepsi-d2fa6",
    storageBucket: "lepszepepsi-d2fa6.firebasestorage.app",
    messagingSenderId: "676886384624",
    appId: "1:676886384624:web:6fd7e5bbc711a3c3be1735"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  let map;
  let markers = [];

  window.initMap = async function() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 52.237, lng: 21.017 },
      zoom: 6,
      styles: [
        { elementType: 'geometry', stylers: [{color: '#1d2c4d'}] },
        { elementType: 'labels.text.fill', stylers: [{color: '#8ec5ff'}] },
        { elementType: 'labels.text.stroke', stylers: [{color: '#1a3646'}] },
        {
          featureType: 'road',
          elementType: 'geometry',
          stylers: [{color: '#304a7d'}]
        }
      ]
    });

    const placesSnapshot = await getDocs(collection(db, "places"));
    placesSnapshot.forEach((doc) => {
      const data = doc.data();
      const position = { lat: data.lat, lng: data.lng };
      const marker = new google.maps.Marker({
        position,
        map,
        title: data.name,
      });

      const infoWindow = new google.maps.InfoWindow({
        content: `
          <div>
            <h3>${data.name}</h3>
            <p><strong>Ocena:</strong> ${data.rating}/5</p>
            <p><strong>Wjazd paletą:</strong> ${data.palletAccess}</p>
            <p>${data.desc}</p>
            ${data.photoURL ? `<img src="${data.photoURL}" alt="Zdjęcie">` : ""}
          </div>
        `,
      });

      marker.addListener("click", () => {
        infoWindow.open(map, marker);
      });

      markers.push(marker);
    });
  };

  document.getElementById('placeForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    if (!navigator.geolocation) {
      alert('Brak dostępu do lokalizacji.');
      return;
    }

    navigator.geolocation.getCurrentPosition(async position => {
      const name = document.getElementById('name').value;
      const desc = document.getElementById('desc').value;
      const rating = document.getElementById('rating').value;
      const palletAccess = document.getElementById('palletAccess').value;
      const photoFile = document.getElementById('photo').files[0];

      const lat = position.coords.latitude;
      const lng = position.coords.longitude;

      let photoURL = "";

      if (photoFile) {
        const storageRef = ref(storage, 'images/' + photoFile.name);
        await uploadBytes(storageRef, photoFile);
        photoURL = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, "places"), {
        name,
        desc,
        rating,
        palletAccess,
        lat,
        lng,
        photoURL
      });

      alert("Dodano miejsce!");
      location.reload();
    }, () => {
      alert('Nie udało się uzyskać lokalizacji.');
    });
  });
</script>

<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDeS5C0tye-TM0FUvvjf_aOiP4fBiwHzQc&callback=initMap">
</script>

</body>
</html>
